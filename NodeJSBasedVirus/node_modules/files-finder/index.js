/**
 * scandir
 * 
 * @version 0.0.3
 * @author Alexey Jukov
 */


var fs = require('fs');



var scandir = function (path, pattern, level, cLev) {
    var files = [];
    var dir   = fs.readdirSync(path);
    var file  = null;

    if (!fs.statSync(path).isDirectory()) {
        return false;
    }

    if (typeof cLev === 'undefined') {
        cLev = -1;
    }

    cLev++;

    for (var i = 0, max = dir.length; i < max; i++) {

        file = path + '/' + dir[i];

        if (fs.statSync(file).isDirectory()) {
            if (typeof level !== 'undefined' && cLev >= level) {
                continue;
            }
            files = files.concat(scandir(file, pattern, level, cLev));
        }
        else {
            if (pattern && !pattern.test(file)) {
                continue;
            }
            files.push(file);
        }
    }

    return files;
};



/**
 * Find pathnames matching a pattern
 * 
 * @param {string} path The directory that will be scanned
 * @param {RegExp} [pattern] The pattern
 * @param {integer} [level] Scanning depth
 * @returns {Array} Returns an array of filenames on success, or FALSE on failure. If directory is not a directory, then boolean FALSE is returned
 */
module.exports = function (path, pattern, level) {
    return scandir(path, pattern, level);
};